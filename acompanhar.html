<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Acompanhar Encomenda 💌</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Cabeçalho -->
  <header class="topo-site">
    <img src="assets/logo.png" alt="Logo Lírio D. Design" class="logo" />
    <nav class="menu-principal">
      <ul>
        <li><a href="index.html">✿ Início</a></li>
        <li><a href="sobre.html">✿ Sobre</a></li>
        <li><a href="portfolio.html">✿ Portfólio</a></li>
        <li><a href="servicos.html">✿ Serviços</a></li>
        <li><a href="contato.html">✿ Contato</a></li>
      </ul>
    </nav>
  </header>

  <main class="acompanhar">
    <section class="acompanhar-container" style="text-align: center; max-width: 600px; margin: auto;">
      <h1>Acompanhe seu Pedido 💌</h1>
      <p>Digite o <strong>código de rastreio</strong> para ver um pedido específico ou o <strong>e-mail</strong> para ver todos os seus pedidos.</p>

      <input type="text" id="codigo" placeholder="Código de rastreio (ex: ENCOM-123456)" style="margin-bottom: 1rem; width: 100%; padding: 0.5rem;">
      <button onclick="buscarEncomendaPorCodigo()">🔍 Ver por Código</button>

      <hr style="margin: 2rem 0;">

      <input type="email" id="email" placeholder="Seu e-mail de contato" style="margin-bottom: 1rem; width: 100%; padding: 0.5rem;">
      <button onclick="buscarEncomendasPorEmail()">📧 Ver Todos os Pedidos</button>

      <div id="resultado" style="margin-top: 2rem;"></div>
    </section>
  </main>

  <!-- Rodapé -->
  <footer class="rodape">
    <div class="links-uteis">
      <a href="termos.html">📄 Termos e Condições</a>
      <a href="faq.html">❓ Perguntas Frequentes</a>
      <a href="politica.html">🔒 Política de Privacidade</a>
    </div>
    <p class="creditos">© 2025 Llirio Design — Todos os direitos reservados.</p>
  </footer>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabase = createClient(
      'https://tcnonaprqfcpqmscrbkg.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRjbm9uYXBycWZjcHFtc2NyYmtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ2MzYzOTQsImV4cCI6MjA2MDIxMjM5NH0.0yyj8uPdF3C3eQGPrFBWVvHuczCnHKhnXGsbBpN96Xw'
    );

    function formatarPedido(encomenda) {
      return `
        <div class="card-pedido">
          <h3>${encomenda.titulo || "Sem título"}</h3>
          <p><strong>Autor(a):</strong> ${encomenda.autor || "---"}</p>
          <p><strong>E-mail:</strong> ${encomenda.email || "---"}</p>
          <p><strong>Tipo de Capa:</strong> ${encomenda.tipo_capa || "---"}</p>
          <p><strong>Status:</strong> ${encomenda.status || "---"}</p>
          <a class="botao-verde" href="acompanhar.html?codigo=${encomenda.codigo_rastreio}">📦 Acompanhar este pedido</a>
        </div>
      `;
    }

    async function buscarEncomendaPorCodigo() {
      const codigo = document.getElementById("codigo").value.trim().toUpperCase();
      const resultado = document.getElementById("resultado");
      if (!codigo) return resultado.innerHTML = '<p>Digite um código válido.</p>';

      resultado.innerHTML = '<p>🔍 Buscando pedido...</p>';
      const { data, error } = await supabase.from("encomendas").select("*").eq("codigo_rastreio", codigo).single();

      if (error || !data) {
        resultado.innerHTML = '<p>Nenhuma encomenda encontrada com esse código. 😢</p>';
      } else {
        resultado.innerHTML = formatarPedido(data);
      }
    }

    async function buscarEncomendasPorEmail() {
      const email = document.getElementById("email").value.trim();
      const resultado = document.getElementById("resultado");
      if (!email) return resultado.innerHTML = '<p>Digite um e-mail válido.</p>';

      resultado.innerHTML = '<p>📦 Buscando suas encomendas...</p>';
      const { data, error } = await supabase.from("encomendas").select("*").eq("email", email).order("data_envio", { ascending: false });

      if (error || !data || data.length === 0) {
        resultado.innerHTML = '<p>Nenhuma encomenda encontrada com esse e-mail. 😢</p>';
      } else {
        resultado.innerHTML = data.map(formatarPedido).join('');
      }
    }
  </script>
</body>
</html>
