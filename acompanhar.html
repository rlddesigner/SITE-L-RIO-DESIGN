<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Acompanhar Encomenda ğŸ’Œ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- CabeÃ§alho -->
  <header class="topo-site">
    <img src="assets/logo.png" alt="Logo LÃ­rio D. Design" class="logo" />
    <nav class="menu-principal">
      <ul>
        <li><a href="index.html">âœ¿ InÃ­cio</a></li>
        <li><a href="sobre.html">âœ¿ Sobre</a></li>
        <li><a href="portfolio.html">âœ¿ PortfÃ³lio</a></li>
        <li><a href="servicos.html">âœ¿ ServiÃ§os</a></li>
        <li><a href="contato.html">âœ¿ Contato</a></li>
      </ul>
    </nav>
  </header>

  <main class="acompanhar">
    <section class="acompanhar-container" style="text-align: center; max-width: 600px; margin: auto;">
      <h1>Acompanhe seu Pedido ğŸ’Œ</h1>
      <p>Digite o <strong>cÃ³digo de rastreio</strong> para ver um pedido especÃ­fico ou o <strong>e-mail</strong> para ver todos os seus pedidos.</p>

      <input type="text" id="codigo" placeholder="CÃ³digo de rastreio (ex: ENCOM-123456)" style="margin-bottom: 1rem; width: 100%; padding: 0.5rem;">
      <button onclick="buscarEncomendaPorCodigo()">ğŸ” Ver por CÃ³digo</button>

      <hr style="margin: 2rem 0;">

      <input type="email" id="email" placeholder="Seu e-mail de contato" style="margin-bottom: 1rem; width: 100%; padding: 0.5rem;">
      <button onclick="buscarEncomendasPorEmail()">ğŸ“§ Ver Todos os Pedidos</button>

      <div id="resultado" style="margin-top: 2rem;"></div>
    </section>
  </main>

  <!-- RodapÃ© -->
  <footer class="rodape">
    <div class="links-uteis">
      <a href="termos.html">ğŸ“„ Termos e CondiÃ§Ãµes</a>
      <a href="faq.html">â“ Perguntas Frequentes</a>
      <a href="politica.html">ğŸ”’ PolÃ­tica de Privacidade</a>
    </div>
    <p class="creditos">Â© 2025 Llirio Design â€” Todos os direitos reservados.</p>
  </footer>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabase = createClient(
      'https://tcnonaprqfcpqmscrbkg.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRjbm9uYXBycWZjcHFtc2NyYmtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ2MzYzOTQsImV4cCI6MjA2MDIxMjM5NH0.0yyj8uPdF3C3eQGPrFBWVvHuczCnHKhnXGsbBpN96Xw'
    );

    function formatarPedido(encomenda) {
      return `
        <div class="card-pedido">
          <h3>${encomenda.titulo || "Sem tÃ­tulo"}</h3>
          <p><strong>Autor(a):</strong> ${encomenda.autor || "---"}</p>
          <p><strong>E-mail:</strong> ${encomenda.email || "---"}</p>
          <p><strong>Tipo de Capa:</strong> ${encomenda.tipo_capa || "---"}</p>
          <p><strong>Status:</strong> ${encomenda.status || "---"}</p>
          <a class="botao-verde" href="acompanhar.html?codigo=${encomenda.codigo_rastreio}">ğŸ“¦ Acompanhar este pedido</a>
        </div>
      `;
    }

    async function buscarEncomendaPorCodigo() {
      const codigo = document.getElementById("codigo").value.trim().toUpperCase();
      const resultado = document.getElementById("resultado");
      if (!codigo) return resultado.innerHTML = '<p>Digite um cÃ³digo vÃ¡lido.</p>';

      resultado.innerHTML = '<p>ğŸ” Buscando pedido...</p>';
      const { data, error } = await supabase.from("encomendas").select("*").eq("codigo_rastreio", codigo).single();

      if (error || !data) {
        resultado.innerHTML = '<p>Nenhuma encomenda encontrada com esse cÃ³digo. ğŸ˜¢</p>';
      } else {
        resultado.innerHTML = formatarPedido(data);
      }
    }

    async function buscarEncomendasPorEmail() {
      const email = document.getElementById("email").value.trim();
      const resultado = document.getElementById("resultado");
      if (!email) return resultado.innerHTML = '<p>Digite um e-mail vÃ¡lido.</p>';

      resultado.innerHTML = '<p>ğŸ“¦ Buscando suas encomendas...</p>';
      const { data, error } = await supabase.from("encomendas").select("*").eq("email", email).order("data_envio", { ascending: false });

      if (error || !data || data.length === 0) {
        resultado.innerHTML = '<p>Nenhuma encomenda encontrada com esse e-mail. ğŸ˜¢</p>';
      } else {
        resultado.innerHTML = data.map(formatarPedido).join('');
      }
    }
  </script>
</body>
</html>
